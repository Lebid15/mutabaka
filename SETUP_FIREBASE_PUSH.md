# Ø¥Ø¹Ø¯Ø§Ø¯ Firebase Cloud Messaging Ù„Ù„Ù€ Push Notifications

## Ø§Ù„Ù…Ø±Ø­Ù„Ø© 1: Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø´Ø±ÙˆØ¹ Firebase (5 Ø¯Ù‚Ø§Ø¦Ù‚)

### 1. Ø§Ø°Ù‡Ø¨ Ø¥Ù„Ù‰ Firebase Console:
ğŸ‘‰ https://console.firebase.google.com/

### 2. Ø§Ø¶ØºØ· "Add project" Ø£Ùˆ "Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø´Ø±ÙˆØ¹"

### 3. Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹:
```
mutabaka
```

### 4. ØªØ¹Ø·ÙŠÙ„ Google Analytics (Ø§Ø®ØªÙŠØ§Ø±ÙŠ):
- ÙŠÙ…ÙƒÙ†Ùƒ ØªØ¹Ø·ÙŠÙ„Ù‡ Ù„Ù„ØªØ³Ø±ÙŠØ¹
- Ø£Ùˆ ØªÙØ¹ÙŠÙ„Ù‡ Ø¥Ø°Ø§ ØªØ±ÙŠØ¯ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª

### 5. Ø§Ø¶ØºØ· "Create project"

---

## Ø§Ù„Ù…Ø±Ø­Ù„Ø© 2: Ø¥Ø¶Ø§ÙØ© ØªØ·Ø¨ÙŠÙ‚ Android (3 Ø¯Ù‚Ø§Ø¦Ù‚)

### 1. ÙÙŠ ØµÙØ­Ø© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ØŒ Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø£ÙŠÙ‚ÙˆÙ†Ø© Android

### 2. Ø£Ø¯Ø®Ù„ Package Name:
```
com.lebid15.mutabaka
```

**âš ï¸ Ù…Ù‡Ù… Ø¬Ø¯Ø§Ù‹:** Package name ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ·Ø§Ø¨Ù‚ Ù…Ø§ ÙÙŠ `app.json`

### 3. App nickname (Ø§Ø®ØªÙŠØ§Ø±ÙŠ):
```
Mutabaka Mobile
```

### 4. Ø§ØªØ±Ùƒ SHA-1 ÙØ§Ø±ØºØ§Ù‹ (ØºÙŠØ± Ù…Ø·Ù„ÙˆØ¨ Ù„Ù„Ù€ Push Notifications)

### 5. Ø§Ø¶ØºØ· "Register app"

---

## Ø§Ù„Ù…Ø±Ø­Ù„Ø© 3: ØªØ­Ù…ÙŠÙ„ google-services.json (2 Ø¯Ù‚Ø§Ø¦Ù‚)

### 1. Ø§Ø¶ØºØ· "Download google-services.json"

### 2. Ø§Ø­ÙØ¸ Ø§Ù„Ù…Ù„Ù ÙÙŠ:
```
F:\mtk\mobile\google-services.json
```

**âš ï¸ ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† ÙÙŠ Ù†ÙØ³ Ù…Ø¬Ù„Ø¯ `app.json`**

### 3. Ø§Ø¶ØºØ· "Next" â†’ "Next" â†’ "Continue to console"

---

## Ø§Ù„Ù…Ø±Ø­Ù„Ø© 4: ØªÙØ¹ÙŠÙ„ Cloud Messaging API (2 Ø¯Ù‚Ø§Ø¦Ù‚)

### 1. ÙÙŠ Firebase ConsoleØŒ Ø§Ø°Ù‡Ø¨ Ø¥Ù„Ù‰:
```
Project Settings (âš™ï¸) â†’ Cloud Messaging
```

### 2. Ø§Ù†Ø³Ø® **Server Key** (Ø³Ù†Ø­ØªØ§Ø¬Ù‡ Ù„Ø§Ø­Ù‚Ø§Ù‹)

### 3. ØªØ£ÙƒØ¯ Ø£Ù† **Cloud Messaging API** Ù…ÙØ¹Ù‘Ù„:
- Ø¥Ø°Ø§ Ø¸Ù‡Ø± Ø²Ø± "Enable", Ø§Ø¶ØºØ· Ø¹Ù„ÙŠÙ‡
- Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ÙØ¹Ù‘Ù„Ø§Ù‹ Ø¨Ø§Ù„ÙØ¹Ù„ØŒ Ø³ØªØ¬Ø¯ "Enabled" âœ…

---

## Ø§Ù„Ù…Ø±Ø­Ù„Ø© 5: Ø¥Ø¹Ø¯Ø§Ø¯ Expo Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… FCM (3 Ø¯Ù‚Ø§Ø¦Ù‚)

### 1. Ø§ÙØªØ­ `app.json` ÙˆØ£Ø¶Ù:

```json
{
  "expo": {
    "android": {
      "package": "com.lebid15.mutabaka",
      "googleServicesFile": "./google-services.json"
    },
    "plugins": [
      [
        "expo-notifications",
        {
          "icon": "./assets/icon.png",
          "color": "#ffffff",
          "sounds": []
        }
      ]
    ]
  }
}
```

### 2. ØªØ£ÙƒØ¯ Ø£Ù† `google-services.json` Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ:
```
F:\mtk\mobile\google-services.json
```

### 3. ÙÙŠ Terminal:
```bash
cd f:\mtk\mobile
npm run android
```

---

## Ø§Ù„Ù…Ø±Ø­Ù„Ø© 6: Ø§Ø®ØªØ¨Ø§Ø± Push Notifications

### 1. Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„ ÙÙŠ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚

### 2. ÙˆØ§ÙÙ‚ Ø¹Ù„Ù‰ Ø£Ø°ÙˆÙ†Ø§Øª Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª

### 3. ÙÙŠ Metro Bundler ConsoleØŒ Ø§Ø¨Ø­Ø« Ø¹Ù†:
```
[Login] âœ… Push token obtained successfully: ExponentPushToken[xxxxx]
```

### 4. ÙÙŠ Django Shell:
```python
from accounts.models import UserDevice
from communications.push import send_message_push

device = UserDevice.objects.filter(push_token__isnull=False).first()

if device:
    print(f"âœ… Device: {device.device_name}")
    print(f"âœ… Token: {device.push_token[:50]}...")
    
    result = send_message_push(
        recipient=device.user,
        sender_name="Firebase Test",
        conversation_id=1,
        message_text="ğŸ”¥ Firebase Push Notification ØªØ¹Ù…Ù„ Ø§Ù„Ø¢Ù†!"
    )
    print(f"ğŸ“© Result: {result}")
```

### 5. ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ¸Ù‡Ø± Ø¥Ø´Ø¹Ø§Ø± ÙÙŠ Ø§Ù„Ù…Ø­Ø§ÙƒÙŠ! ğŸ””

---

## âœ… ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ù†Ø¬Ø§Ø­:

- [ ] Ù…Ø´Ø±ÙˆØ¹ Firebase ØªÙ… Ø¥Ù†Ø´Ø§Ø¤Ù‡
- [ ] `google-services.json` ØªÙ… ØªØ­Ù…ÙŠÙ„Ù‡
- [ ] Ø§Ù„Ù…Ù„Ù Ù…ÙˆØ¶ÙˆØ¹ ÙÙŠ `mobile/google-services.json`
- [ ] `app.json` ØªÙ… ØªØ­Ø¯ÙŠØ«Ù‡
- [ ] Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ÙŠØ¹Ù…Ù„ Ø¨Ø¯ÙˆÙ† Ø£Ø®Ø·Ø§Ø¡
- [ ] Push Token ÙŠØ¸Ù‡Ø± ÙÙŠ Console
- [ ] Push Token ÙŠÙØ­ÙØ¸ ÙÙŠ Database
- [ ] Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± ÙŠØµÙ„ Ù„Ù„Ù…Ø­Ø§ÙƒÙŠ

---

## ğŸ› Ø§Ø³ØªÙƒØ´Ø§Ù Ø§Ù„Ø£Ø®Ø·Ø§Ø¡:

### Ø®Ø·Ø£: "Default FirebaseApp is not initialized"
**Ø§Ù„Ø­Ù„:** ØªØ£ÙƒØ¯ Ø£Ù† `google-services.json` ÙÙŠ Ø§Ù„Ù…ÙƒØ§Ù† Ø§Ù„ØµØ­ÙŠØ­

### Ø®Ø·Ø£: "Package name mismatch"
**Ø§Ù„Ø­Ù„:** ØªØ£ÙƒØ¯ Ø£Ù† Package name ÙÙŠ Firebase = Package name ÙÙŠ `app.json`

### Ø®Ø·Ø£: "Cloud Messaging API disabled"
**Ø§Ù„Ø­Ù„:** ÙØ¹Ù‘Ù„ Cloud Messaging API Ù…Ù† Firebase Console

---

## ğŸ“š Ù…ØµØ§Ø¯Ø± Ø¥Ø¶Ø§ÙÙŠØ©:

- [Expo Push Notifications with FCM](https://docs.expo.dev/push-notifications/fcm-credentials/)
- [Firebase Cloud Messaging](https://firebase.google.com/docs/cloud-messaging)
- [Expo Notifications API](https://docs.expo.dev/versions/latest/sdk/notifications/)
