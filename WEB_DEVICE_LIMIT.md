# ุญุฏ ุฃุฌูุฒุฉ ุงูููุจ (Web Device Limit)

## ๐ ุงูููุฎุต
ุชู ุฅุถุงูุฉ ุญุฏ ุฃูุตู **5 ูุชุตูุญุงุช** ููู ูุณุชุฎุฏู ุนูุฏ ุชุณุฌูู ุงูุฏุฎูู ุนุจุฑ QR Code.

---

## ๐ง ุงูุชุบููุฑุงุช ุงููุทุจูุฉ

### 1๏ธโฃ **ุฅุนุฏุงุฏุงุช ุฌุฏูุฏุฉ** (`mujard/settings.py`)
```python
USER_WEB_DEVICE_MAX_ACTIVE = int(os.getenv('USER_WEB_DEVICE_MAX_ACTIVE', '5'))
```
- **ุงููููุฉ ุงูุงูุชุฑุงุถูุฉ:** 5 ูุชุตูุญุงุช
- **ูุงุจู ููุชุนุฏูู:** ุนุจุฑ ูุชุบูุฑ ุงูุจูุฆุฉ `USER_WEB_DEVICE_MAX_ACTIVE`

---

### 2๏ธโฃ **ุฏุงูุฉ ุฌุฏูุฏุฉ** (`accounts/device_service.py`)
```python
def count_active_web_devices(user) -> int:
    """ุญุณุงุจ ุนุฏุฏ ุฃุฌูุฒุฉ ุงูููุจ ุงููุดุทุฉ ูููุณุชุฎุฏู"""
    return UserDevice.objects.filter(
        user=user, 
        status__in=_ACTIVE_STATUSES, 
        is_web=True
    ).count()
```

---

### 3๏ธโฃ **ูุญุต ุงูุญุฏ ุนูุฏ ุงูููุงููุฉ** (`accounts/qr_login_views.py`)
ุนูุฏ ูุณุญ QR Code ูุงูููุงููุฉ ุนูู ุชุณุฌูู ุฏุฎูู ูุชุตูุญ ุฌุฏูุฏ:
- โ **ุฅุฐุง ูุงู ุงูุนุฏุฏ < 5:** ูุชู ุฅูุดุงุก ุงูุฌูุงุฒ ุจูุฌุงุญ
- โ **ุฅุฐุง ูุงู ุงูุนุฏุฏ = 5:** ูุชู ุฑูุถ ุงูุทูุจ ูุน ุฑุณุงูุฉ:
```json
{
  "detail": "web_device_limit_reached",
  "message": "ุงูุญุฏ ุงูุฃูุตู 5 ูุชุตูุญุงุช. ูุฑุฌู ุฅูุบุงุก ูุชุตูุญ ูุฏูู ุฃููุงู.",
  "limit": 5,
  "current": 5
}
```
**HTTP Status:** `409 Conflict`

---

## ๐ ุฌุฏูู ุงูุญุฏูุฏ

| ููุน ุงูุฌูุงุฒ | ุงูุญุฏ ุงูุฃูุตู | ุงูููุฏ |
|-----------|-------------|-------|
| ๐ฑ **Mobile (Android/iOS)** | **3** | `USER_DEVICE_MAX_ACTIVE` |
| ๐ **Web (Browsers)** | **5** | `USER_WEB_DEVICE_MAX_ACTIVE` |
| **ุงููุฌููุน** | **8 ุฃุฌูุฒุฉ** | ูููุตู (3 ููุจุงูู + 5 ููุจ) |

---

## ๐งช ุงูุงุฎุชุจุงุฑุงุช

ุชู ุฅุถุงูุฉ ุงุฎุชุจุงุฑ `test_web_device_limit_enforced` ูู `test_web_login.py`:
- โ ุงูุชุญูู ูู ุฅูุดุงุก 5 ูุชุตูุญุงุช ุจูุฌุงุญ
- โ ุฑูุถ ุงููุชุตูุญ ุงูุณุงุฏุณ
- โ ุงูุชุญูู ูู ุฑุณุงูุฉ ุงูุฎุทุฃ ุงูุตุญูุญุฉ

**ูุชุดุบูู ุงูุงุฎุชุจุงุฑ:**
```bash
cd backend
python manage.py test accounts.tests.test_web_login.WebLoginFlowTests.test_web_device_limit_enforced
```

---

## ๐ ุฅุฏุงุฑุฉ ุงููุชุตูุญุงุช ูู Django Admin

### ูุญุฐู ูุชุตูุญ ูุฏูู:
1. `Admin Panel` โ `User Devices`
2. **Filter:** `Is web = Yes`, `Status = Active`
3. **ุงุฎุชุฑ ุงูุฌูุงุฒ** โ ุบููุฑ Status ุฅูู `Revoked`
4. **ุงุญูุธ** โ

### ูุฑุคูุฉ ุฌููุน ูุชุตูุญุงุช ูุณุชุฎุฏู ูุนูู:
```
User Devices โ Filter by User + Is Web = Yes
```

---

## ๐ ูุชุบูุฑุงุช ุงูุจูุฆุฉ

ูุชุบููุฑ ุงูุญุฏ ุงูุฃูุตูุ ุฃุถู ุฅูู `.env`:
```bash
USER_WEB_DEVICE_MAX_ACTIVE=10  # ูุซุงู: ุฒูุงุฏุฉ ุงูุญุฏ ุฅูู 10 ูุชุตูุญุงุช
```

---

## ๐ ููุงุญุธุงุช

1. **ุงูุญุฏ ูููุตู ุนู ุงูููุจุงููุงุช:** ุงููุณุชุฎุฏู ููููู ุงูุญุตูู ุนูู 3 ููุจุงููุงุช + 5 ูุชุตูุญุงุช
2. **ูุง ูุคุซุฑ ุนูู ุงูุฃุฌูุฒุฉ ุงูููุฌูุฏุฉ:** ุฅุฐุง ูุงู ูุฏูู 7 ูุชุตูุญุงุช ุญุงููุงูุ ูู ูุชู ุญุฐููุง ุชููุงุฆูุงู
3. **ุงูุญุฏ ููุทุจู ููุท ุนูู ุงูุฌุฏูุฏุฉ:** ุณูุชู ุฑูุถ ุงููุชุตูุญุงุช ุงูุฌุฏูุฏุฉ ุนูุฏ ุงููุตูู ููุญุฏ

---

## ๐ ุงูุชุทุจูู ูู Production

ุจุนุฏ Deploy:
1. โ ูู ุจุชุดุบูู ุงูุงุฎุชุจุงุฑุงุช
2. โ ุชุญูู ูู `settings.py` ุฃู `USER_WEB_DEVICE_MAX_ACTIVE` ูุถุจูุท ุนูู 5
3. โ ุฌุฑูุจ ูุณุญ QR Code ูู 6 ูุชุตูุญุงุช ูุฎุชููุฉ ููุชุฃูุฏ

---

**ุชุงุฑูุฎ ุงูุฅูุดุงุก:** 2025-10-05  
**ุงููุทูุฑ:** GitHub Copilot
