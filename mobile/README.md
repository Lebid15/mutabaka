# تطبيق مطابقة للهواتف (React Native)

هذا المجلد يحتوي على نسخة مبسطة من واجهة الويب لتطبيق مطابقة مبنية باستخدام **Expo** و **React Native** مع **NativeWind** لمواءمة التصميم والألوان مع الواجهة الأصلية.

## المتطلبات
- Node.js 18 أو أحدث
- Expo CLI (اختياري، يمكن التشغيل عبر `npx`)

## التثبيت
من داخل مجلد `mobile/`:

```powershell
npm install
```

## الأوامر الأساسية
- تشغيل التطبيق على Expo Go أو المحاكي:

  ```powershell
  npm run start
  ```

- تشغيل نسخة الويب (تجريبية):

  ```powershell
  npm run web
  ```

## البنية
- `App.tsx`: يضبط ThemeProvider والتنقل العام.
- `src/theme/`: يحتوي على design tokens وحالة السمة (فاتح/داكن).
- `src/components/`: مكونات UI قابلة لإعادة الاستخدام (أزرار، مدخلات، فقاعات الدردشة...إلخ).
- `src/screens/`: الشاشات الرئيسية (تسجيل الدخول، الرئيسية، الدردشة).
- `src/data/mock.ts`: بيانات تجريبية لعرض القوائم والمحادثات.

## إعداد الاتصال بالواجهة الخلفية
1. أنشئ ملف بيئة جديدًا انطلاقاً من القالب:

  ```powershell
  Copy-Item .env.example .env
  ```

2. القيم الافتراضية في `.env.example` مهيأة للإتصال بالمخدّم المحلي عبر المحاكي (`http://10.0.2.2:8000`). إذا كنت تستخدم جهازاً حقيقياً، غيِّر العناوين إلى عنوان جهازك (مثال: `http://192.168.1.20:8000`).
  - `EXPO_PUBLIC_API_BASE_URL` للمسار الكامل لـ `/api`.
  - `EXPO_PUBLIC_WS_BASE_URL` لمسار WebSocket، عادةً `ws://<ip>:8000/ws`.
  - `EXPO_PUBLIC_TENANT_HOST` يوضع غالباً على نفس الـ host (مثل `localhost` أو عنوان الشبكة).

3. لإعادة التطبيق إلى الخادم الإنتاجي بعد الانتهاء من الاختبارات، عدِّل ملف البيئة واجعل `EXPO_PUBLIC_APP_ENV=production` وحدّث المسارات إلى نطاق الإنتاج (`https://mutabaka.com/api` و `wss://ws.mutabaka.com/ws`).

4. بعد أي تغيير في ملف البيئة، أعد تشغيل Expo لتطبيق الإعدادات.

### ما تم تنفيذه
- أي طلب HTTP يمر عبر ملف `src/lib/httpClient.ts` يضيف تلقائياً ترويسة `Authorization: Bearer` و`X-Tenant-Host`.
- يتم حفظ رموز JWT في `AsyncStorage` مع تخزين مؤقت بالذاكرة لتقليل الوصول للقرص.
- شاشة تسجيل الدخول تستدعي `POST /api/auth/token/` أو تسجيل دخول الفريق عبر `POST /api/auth/team/login` ثم تخزن الرموز وتعيد التوجيه للواجهة الرئيسية.
- شاشة المحادثات (`HomeScreen`) وجدت المستخدم الحالي، حمّلت قائمة المحادثات من `/api/conversations/`، وعرضت صورة الطرف الآخر إن وُجدت.
- شاشة الدردشة (`ChatScreen`) تعرض رسائل المحادثة من `/api/messages/` مع تحديث حالة التسليم/القراءة.

## مزامنة التصميم
- تم إعادة استخدام قيم الألوان والمسافات من الواجهة الأمامية (Tailwind) داخل NativeWind.
- زر التبديل بين الوضعين الفاتح والداكن يعكس نفس السلوك الموجود في الويب.
- شاشة الدردشة تستخدم نفس ألوان الفقاعات والبطاقات مع تباين ملائم.

## خطوات لاحقة مقترحة
- إضافة شاشة تفاصيل المحادثة (المشاركون، الكتم، الحذف).
- تنفيذ إرسال الرسائل والمعاملات المالية عبر API.
- دعم الإشعارات الفعلية (Push Notifications) للتطابق مع تجربة الويب.
